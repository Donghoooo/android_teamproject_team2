<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="bitc.fullstack503.moneylog_spring.mapper.SearchMapper">
    <select id="getSearchList" resultType="bitc.fullstack503.moneylog_spring.dto.SearchDTO">
        SELECT 'income' AS type, income_log_seq AS seq, income_cate AS category, income_source AS source, income_money AS money, income_date AS date, `income_use` AS `use`
        FROM income_log
        <where>
            member_id = 'test1'
            AND income_date BETWEEN #{startDate} AND #{endDate}
            <if test="category != null and category.size() > 0">
                AND income_cate IN
                <foreach item="item" collection="category" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>
            <if test="source != null and source.size() > 0">
                AND income_source IN
                <foreach item ="item" collection="source" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>

            <if test="keyword != null and keyword != ''">
                AND (
                income_cate LIKE CONCAT('%', #{keyword}, '%')
                OR income_source LIKE CONCAT('%', #{keyword}, '%')
                OR income_use LIKE CONCAT('%', #{keyword}, '%')
                )
            </if>
        </where>

        UNION ALL

        SELECT 'expense' AS type, expense_log_seq AS seq, expense_cate AS category, payment_option AS source, expense_money AS money, expense_date AS date, `expense_use` AS `use`
        FROM expense_log
        <where>
            member_id = 'test1'
            AND expense_date BETWEEN #{startDate} AND #{endDate}
            <if test="category != null and category.size() > 0">
                AND expense_cate IN
                <foreach item="item" collection="category" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>
            <if test="source != null and source.size() > 0">
                AND payment_option IN
                <foreach item ="item" collection="source" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>
            <if test="keyword != null and keyword !=''">
                AND (
                expense_cate LIKE CONCAT('%', #{keyword}, '%')
                OR payment_option LIKE CONCAT('%', #{keyword}, '%')
                OR expense_use LIKE CONCAT('%', #{keyword}, '%')
                )
            </if>
        </where>

        ORDER BY
        <if test="sortBy == 'amount'">
            money DESC
        </if>
        <if test="sortBy == 'date'">
            date ASC
        </if>
    </select>
</mapper>
        <!--<mapper namespace="bitc.fullstack503.moneylog_spring.mapper.SearchMapper">-->
        <!--  <select id="getSearchList" parameterType="java.util.Map" resultType="bitc.fullstack503.moneylog_spring.dto.SearchDTO">-->
        <!--    SELECT 'income' AS type, income_log_seq AS seq, income_cate AS category, income_source AS source, income_money AS money, income_date AS date, `income_use` AS `use`-->
        <!--    FROM income_log-->
        <!--&#45;&#45;     WHERE (#{category} IS NULL OR income_cate = #{category})-->
        <!--&#45;&#45;         AND (#{source} IS NULL OR income_source = #{source})-->
        <!--&#45;&#45;         AND income_date BETWEEN #{startDate} AND #{endDate}-->
        <!--    WHERE (IFNULL(#{category}, '') = '' OR income_cate = #{category})-->
        <!--      AND (IFNULL(#{source}, '') = '' OR income_source = #{source})-->
        <!--      AND income_date BETWEEN #{startDate} AND #{endDate}-->

        <!--    UNION ALL-->

        <!--    SELECT 'expense' AS type, expense_log_seq AS seq, expense_cate AS category, payment_option AS source, expense_money AS money, expense_date AS date, `expense_use` AS `use`-->
        <!--    FROM expense_log-->
        <!--&#45;&#45;     WHERE (#{category} IS NULL OR expense_cate = #{category})-->
        <!--&#45;&#45;         AND (#{source} IS NULL OR payment_option = #{source})-->
        <!--&#45;&#45;         AND expense_date BETWEEN #{startDate} AND #{endDate}-->
        <!--    WHERE (IFNULL(#{category}, '') = '' OR expense_cate = #{category})-->
<!--<!—      AND (IFNULL(#{source}, '') = '' OR payment_option = #{source})—>-->
<!--<!—      AND expense_date BETWEEN #{startDate} ANd #{endDate}—>-->
<!--<!—  </select>—>-->
<!--<!—</mapper>—>-->